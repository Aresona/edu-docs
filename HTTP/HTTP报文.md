# HTTP报文

如果说HTTP是因特网的信使，那么HTTP报文就是它用来搬东西的包裹了。

## 报文流

HTTP报文是在HTTP应用程序之间发送的数据块。这些数据块以一些文本形式的元信息(meta-information)开头，这些信息描述了报文的内容及含义，后面跟着可选的数据部分。这些报文在客户端、服务器和代理之间流动。术语"流入"、"流出"、"上游"、"下游"都是用来描述报文方向的。

### 报文注入源端服务器

HTTP使用术语流入(inbound)和流出(outbound)来描述事务处理(transaction)的方向。报文流入源端服务器。工作完成之后，会流回用户的Agent代理中。

### 报文向下游流动

HTTP报文会像河水一样流动。不管是请求报文还是响应报文，所有报文都会向下游(downstream)流动。所有报文的发送者都在接收者的上游(upstream)。对于请求报文来说，代理1位于代理3的上游，但对响应报文来说，它就位于代理3的下游。没有报文会向上游流动。

> 术语上游和下游都只与发送者和接收者有关。我们无法区分报文是发送给源端服务器还是发送给客户端的，因为两者都是下游节点。

## 报文的组成部分

### 报文的语法
每条报文都包含一条来自客户端的请求，或者一条来自服务器的响应。它们由三个部分组成：start line 、header 、 body;

实体的主体或报文的主体(或者就称为主体)是一个可选的数据块。与起始行和首部不同的是，主体中可以包含文本或二进制数据，也可以为空。一般 `content-type` 说明了主体是什么。`content-length`说明了有多大，单位是字节。


- 首部(header)

可以有零个或多个首部，每个首部都包含一个名字，后面跟着一个冒号(:)，然后是一个可选的空格，接着是一个值，最后是一个CRLF。首部是由一个空行结束的，表示了首部列表的结束和实体主体部分的开始。有些HTTP版本，如HTTP/1.1,要求有效的请求或响应报文中必须包含特定的首部。

- 实体的主体部分(entity-body)

实体的主体部分包含一个由任意数据组成的数据块。并不是所有的报文都包含实体的主体部分，有时，报文只是以一个CRLF结束。

### 起始行

所有的HTTP报文都以一个起始行作为开始。请求报文的起始行说明了要做些什么。响应报文的起始行说明发生了什么。

#### 请求行

请求报文请求服务器对资源进行一些操作。请求报文的起始行，或称为请求行，包含了一个方法和一个请求的URL，这个方法描述了服务器应该执行的操作，请求URL描述了对哪个资源执行这个方法。

#### 响应行

响应报文承载了状态信息和操作产生的所有结果数据，将其返回给客户端。响应报文的起始行，或称为响应行，包含了响应报文使用的HTTP版本、数字状态码，以及描述操作状态的文本形式的原因短语。

#### 方法

请求的起始行以方法作为开始，方法用来告知服务器要做些什么。常见的HTTP方法如下：

方法 | 描述 | 是否包含主体
--- | ---| ---
GET | 从服务器获取一份文档 | 否
HEAD | 只从服务器获取文档的首部 | 否
POST | 向服务器发磅需要处理的数据 | 是
PUT | 将请求的主体部分存储在服务器上 | 是
TRACE | 对可能经过代理服务器传送到服务器上去的报文进行追踪 | 否
OPTIONS | 决定可以在服务器上执行哪些方法 | 否
DELETE | 从服务器上删除一份文档 | 否

并不是所有服务器都实现了上面7种方法。而且，由于HTTP设计得易于扩展，所以除了这些方法之外，其他服务器可能还会实现一些自己的请求方法。这些附加的方法是对HTTP规范的扩展，因此被称为扩展方法。

#### 状态码

状态码便于程序进行差错处理，而原因短语则更便于人们理解。

可以通过三位数字代码对不同状态码进行分类。200到299之间的状态码表示成功。200到399之间的代码表示资源已经被移走了。400到499之间的代码表示客户端的请求出错了。500到599之间的代码表示服务器出错了。

整体范围 | 已定义范围 |  分类
--- | --- | ---
100~199 | 100~101 | 信息提示
200~299 | 200~206 | 成功
300~399 | 300~305 | 重定向
400~499 | 400~415 | 客户端错误
500~599 | 500~515 | 服务器错误

当前的HTTP版本只为每类状态定义了几个代码。随着协议的发展，HTTP规范中会正式地定义更多的状态码。如果收到了一不认识的状态码，可能是有人将其作为当前协议的扩展定义。可以根据其所处范围，将它作为那类别中一个普通的成员来处理。

### 首部

HTTP规范定义了几种首部字段。应用程序也可以随意发明自己所用的首部。HTTP首部可以分为以下几类。

#### 首部分类

分类 | 描述
--- | ---
通用首部 | 既可以出现在请求报文中，也可以出现在响应报文中
请求首部 | 提供更多有关请求的信息
响应首部 | 提供更多有关响应的信息
实体首部 | 描述主体的长度和内容，或者资源自身
扩展首部 | 规范中没有定义的新首部

#### 首部延续行

将长的首部行分为多行可以提高可读性，多出来的每行前面至少要有一个空格或制表符(tab)。如：

<pre>
HTTP/1.0 200 OK
Content-Type: image/gif
Content-Length: 8572
Server: Test Server
	Version 1.0
</pre>

该首部的完整值为 `Test Server Version 1.0

#### 实体的主体部分

HTTP报文的第三部分是可选的实体主体部分。实体的主体是HTTP报文的负荷。就是HTTP要传输的内容。

HTTP报文可以承载很多类型的数字数据：图片、视频、HTML文档、软件应用程序、信用卡事务、电子邮件等。

## 方法 

### 安全方法 

HTTP定义了一组被称为安全方法的方法。GET方法和HEAD方法都被认为是安全的，这就意味着使用GET或HEAD方法的HTTP请求都不会产生什么动作。

不产生动作，在这里意味着HTTP请求不会在服务器上产生什么结果。

### GET

GET是最常用的方法。通常用于请求服务器发送某个资源。HTTP/1.1要求服务器实现此方法。

### HEAD

HEAD方法与GET方法的行为很类似，但服务器在响应中只返回首部。不会返回实体的主体部分。这就允许客户端在未获取实际资源的情况下，对资源的首部进行检查。使用HEAD，可以：

* 在不获取资源的情况下了解资源的情况（比如，判断其类型）
* 通过查看响应中的状态码，看看某个对象是否存在
* 通过查看首部，测试资源是否被修改了。

服务器开发者必须确保返回的首部与GET请求所返回的首部完全相同。

### PUT
与GET从服务器读取文档相反，PUT方法会向服务器写入文档。有些发布系统允许用户创建WEB页面，并用PUT直接将其安装到WEB服务器上去。

PUT方法的主义就是让服务器用请求的主体部分来创建一个由所请求的URL命名的新文档，或者，如果那个URL已经存在的话，就用这个主体来替代它。

因为PUT允许用户对内容进行修改，所以很多web服务器都要求在执行PUT之前，用密码登录。

### POST

POST方法真实是用来向服务器输入数据的







