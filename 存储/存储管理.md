# 存储管理
许多存储设备和文件设置只能在安装系统时设置，所以在安装系统前，一定要谨慎规划存储配置

## 安装系统过程中的存储管理
如果想从一个已经做过RAID的盘安装系统时，需要先删除该盘里的RAID元数据,否则可能会存在Anaconda无法检查到该磁盘的情况。

<pre>
dmraid -r -E /device/</pre>

## 文件系统检查
可以使用文件系统特定的用户空间工具检查文件系统的一致性。并选择修复。这些工具通常被称为 `fsck` 工具。

> 文件系统检查程序只保证整个文件系统的元数据一致性；但不会知道真实的数据，也不能当做数据恢复工具来用

一般文件系统不一致的发生可能有如下三个原因：

1. 硬件错误
2. 存储管理错误
3. 软件BUGS

在现代元数据日志文件系统普遍以前，一旦系统崩溃或者断电都需要做文件系统的检查。因为文件系统更新可能被中断，所以会存在不一致的状况。因此一般在开机时会对 `/etc/fstab` 文件里面指定的文件系统进行检查。对于日志文件系统，检查通常很快。因为文件系统的元数据日志会在系统崩溃时确保数据一致性。但是即使是日志文件系统偶尔也会出现数据不一致的情况。下列提供一些最佳实践

### fsck 最佳实践
一般情况下 fsck 会被用来自动修复一些不一致的数据，但是一些不会被修复好的数据可能会被直接丢弃，可能会导致文件系统发生一些重大的变化，所以为了防止这一状况的出现，请执行以下预防措施：

#### dry run

许多文件检查工具都会提供一个只检查不修复的功能。

#### 首先在文件系统镜像上执行

许多文件系统都支持创建元数据镜像，这是一个只包含文件系统元数据的副本，因此也可以先对该副本进行恢复，如果没问题再对真实文件系统进行恢复。

> 严重的文件系统会导致元数据映像创建失败


#### 只在未挂载的系统上执行

文件系统修复必须运行在一个未挂载的系统上，修复工具必须对磁盘有唯一访问权，否则会导致磁盘进一步损坏。虽然有一些文件系统工具支持在一个挂载的文件系统上做check-only模式，但是绝大多数文件系统会在 `repair mode` 下强制卸载该磁盘，

#### 磁盘错误
文件系统检查工具不能修复硬件问题，如果想恢复文件系统一定要保证硬件完全可读可写。如果是硬件错误，在修复系统前需要先通过dd命令把整个文件系统拷贝到另外一块可用的磁盘上。

## FSCK参数信息
### ext2,ext3,ext4

这些文件系统的检查命令如　`fsck.ext2` 等都是 `e2fsck` 命令的硬链接，并且这些命令会在开机时自动执行。

